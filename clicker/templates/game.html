<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Fitness Clicker</title>
    <script src="https://cdn.tailwindcss.com"></script>
  <body
    class="bg-gray-50 h-full flex flex-col items-center justify-center font-sans p-6"
  >
    <!-- Title -->
    <h1 class="text-4xl font-semibold mb-8 text-gray-900">
      üèãÔ∏è Fitness Clicker
    </h1>

    <!-- Click Stats -->
    <div class="text-xl mb-2 text-gray-700">
      Clicks: <span id="clickCount">{{ clicks }}</span>
    </div>
    <div class="text-md mb-6 text-gray-500">
      Clicks per click: <span id="clickPower">{{ clicks_per_click }}</span>
    </div>

    <!-- Click Button -->
    <button
      id="clickButton"
      class="bg-gray-900 text-white px-8 py-3 rounded-full text-lg hover:bg-gray-800 transition-shadow shadow-sm mb-8"
    >
      üí™ Click!
    </button>

    <div class="flex flex-row gap-6">
      <!-- Upgrades Panel -->
      <div class="w-80 bg-white rounded-lg shadow-sm overflow-hidden">
        <div class="bg-blue-500 text-white px-4 py-2 font-medium text-lg">
          Upgrades
        </div>
        <div id="upgrades" class="p-4 flex flex-col gap-3">
          {% for upgrade in upgrades %}
          <div
            class="upgrade-item border rounded-md p-3 transition flex flex-col"
            data-cost="{{ upgrade.cost }}"
            data-name="{{ upgrade.name }}"
            onclick="purchaseUpgrade('{{ upgrade.name }}', {{ upgrade.cost }})"
          >
            <div class="font-medium text-gray-900">{{ upgrade.name }}</div>
            <div class="text-gray-500 text-sm">
              Cost: {{ upgrade.cost }} clicks
            </div>
            <div class="text-gray-700 text-sm mt-1">
              Power: +{{ upgrade.multiplier }} per click
            </div>
          </div>
          {% endfor %}
        </div>
      </div>

      <!-- Purchased Upgrades Panel -->
      <div class="w-80 bg-white rounded-lg shadow-sm overflow-hidden">
        <div class="bg-blue-500 text-white px-4 py-2 font-medium text-lg">
          Owned Equipment
        </div>
        <div id="purchased" class="p-4 flex flex-col gap-2">
          {% if purchased_upgrades %}
          {% for upgrade in purchased_upgrades %}
          <div class="p-2 bg-gray-100 text-gray-700 rounded">
            {{ upgrade }}
          </div>
          {% endfor %}
          {% else %}
          <div class="text-gray-400 text-sm">No equipment yet.</div>
          {% endif %}
        </div>
      </div>
    </div>

    <!-- Reset Button -->
    <button
      onclick="resetGame()"
      class="mt-6 text-sm text-gray-500 underline hover:text-gray-700"
    >
      Reset Game
    </button>

    <script>
      const clickCountEl = document.getElementById("clickCount");
      const clickPowerEl = document.getElementById("clickPower");

      function updateUpgrades() {
        const clickCount = parseInt(clickCountEl.textContent);
        document.querySelectorAll(".upgrade-item").forEach((item) => {
          const cost = parseInt(item.dataset.cost);
          if (clickCount >= cost) {
            item.classList.add("border-gray-900", "cursor-pointer");
            item.classList.remove("border-gray-300", "opacity-50");
          } else {
            item.classList.remove("border-gray-900", "cursor-pointer");
            item.classList.add("border-gray-300", "opacity-50");
          }
        });
      }

      function getCookie(name) {
        let cookieValue = null;
        if (document.cookie && document.cookie !== "") {
          const cookies = document.cookie.split(";");
          for (let i = 0; i < cookies.length; i++) {
            const cookie = cookies[i].trim();
            if (cookie.substring(0, name.length + 1) === name + "=") {
              cookieValue = decodeURIComponent(
                cookie.substring(name.length + 1)
              );
              break;
            }
          }
        }
        return cookieValue;
      }

      document.getElementById("clickButton").addEventListener("click", () => {
        fetch("/click/", {
          method: "POST",
          headers: { "X-CSRFToken": getCookie("csrftoken") },
        })
          .then((res) => res.json())
          .then((data) => {
            clickCountEl.textContent = data.clicks;
            clickPowerEl.textContent = data.clicks_per_click;
            updateUpgrades();
          });
      });

      function purchaseUpgrade(name, cost) {
        fetch("/purchase/", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            "X-CSRFToken": getCookie("csrftoken"),
          },
          body: JSON.stringify({ upgrade_name: name }),
        })
          .then((res) => res.json())
          .then((data) => {
            if (data.error) {
              alert(data.error);
            } else {
              clickCountEl.textContent = data.clicks;
              clickPowerEl.textContent = data.clicks_per_click;
              location.reload();
            }
          });
      }

      function resetGame() {
        fetch("/reset/")
          .then((res) => res.json())
          .then((data) => {
            clickCountEl.textContent = data.clicks;
            clickPowerEl.textContent = data.clicks_per_click;
            location.reload();
          });
      }

      window.onload = updateUpgrades;
    </script>
  </body>
</html>
